<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PriceNow Pro | Live Market Terminal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@300;400;700;900&family=JetBrains+Mono:wght@400;700&display=swap');
        body { font-family: 'Noto Sans Arabic', sans-serif; background-color: #050505; color: #f1f5f9; direction: rtl; overflow-x: hidden; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        .gold-card { background: linear-gradient(145deg, #111, #080808); border: 1px solid rgba(212, 175, 55, 0.1); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .gold-card:hover { border-color: rgba(212, 175, 55, 0.4); transform: translateY(-4px); box-shadow: 0 10px 30px -10px rgba(212, 175, 55, 0.15); }
        .chart-container { position: relative; height: 120px; width: 100%; }
        .price-up { color: #10b981; }
        .price-down { color: #ef4444; }
        .glow-y { box-shadow: 0 0 20px rgba(234, 179, 8, 0.1); }
        @keyframes pulse-gold { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .live-dot { width: 8px; height: 8px; background: #eab308; border-radius: 50%; animation: pulse-gold 2s infinite; }
        
        #toast-container { position: fixed; bottom: 20px; right: 20px; left: 20px; z-index: 9999; display: flex; flex-direction: column; gap: 10px; pointer-events: none; }
        .toast { background: #18181b; border: 1px solid #eab308; color: white; padding: 12px 20px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.5); transform: translateY(100px); transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); pointer-events: auto; }
        .toast.show { transform: translateY(0); }

        #help-modal { display: none; }
        #help-modal.active { display: flex; }
    </style>
</head>
<body class="min-h-screen">

    <div id="toast-container"></div>

    <div id="help-modal" class="fixed inset-0 bg-black/80 backdrop-blur-md z-[100] items-center justify-center p-4">
        <div class="bg-zinc-900 border border-zinc-800 w-full max-w-2xl rounded-[2.5rem] p-8 shadow-2xl overflow-y-auto max-h-[90vh]">
            <div class="flex justify-between items-start mb-6">
                <div>
                    <h3 class="text-2xl font-black text-yellow-500">Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h3>
                    <p class="text-zinc-500 text-sm mt-1">Ø¥Ø°Ø§ Ù‚Ù…Øª Ø¨Ø§Ù„Ø³Ù…Ø§Ø­ ÙˆÙ„Ù… ØªØµÙ„Ùƒ Ø±Ø³Ø§Ø¦Ù„ØŒ Ø§ØªØ¨Ø¹ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©:</p>
                </div>
                <button onclick="toggleHelp()" class="text-zinc-500 hover:text-white p-2"><i class="fas fa-times text-xl"></i></button>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="bg-black/40 p-6 rounded-3xl border border-zinc-800">
                    <div class="flex items-center gap-3 mb-4">
                        <i class="fab fa-chrome text-xl text-yellow-500"></i>
                        <h4 class="font-bold text-white">Ù…ØªØµÙØ­Ø§Øª Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±</h4>
                    </div>
                    <ul class="space-y-4 text-xs text-zinc-400 leading-relaxed">
                        <li class="flex gap-3">
                            <span class="text-yellow-500 font-bold">1.</span>
                            <span>ØªØ£ÙƒØ¯ Ø£Ù† ÙˆØ¶Ø¹ <b>"Ø¹Ø¯Ù… Ø§Ù„Ø¥Ø²Ø¹Ø§Ø¬"</b> (Do Not Disturb) ÙÙŠ ÙˆÙŠÙ†Ø¯ÙˆØ² Ø£Ùˆ Ù…Ø§Ùƒ Ù…ØºÙ„Ù‚.</span>
                        </li>
                        <li class="flex gap-3">
                            <span class="text-yellow-500 font-bold">2.</span>
                            <span>Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù‚ÙÙ„ (ğŸ”’) ÙˆØªØ£ÙƒØ¯ Ø£Ù† "Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª" Ù…ÙØ¹Ù„Ø©.</span>
                        </li>
                    </ul>
                </div>

                <div class="bg-black/40 p-6 rounded-3xl border border-zinc-800">
                    <div class="flex items-center gap-3 mb-4">
                        <i class="fab fa-apple text-xl text-zinc-400"></i>
                        <h4 class="font-bold text-white">Ø¢ÙŠÙÙˆÙ† (iOS)</h4>
                    </div>
                    <ul class="space-y-4 text-xs text-zinc-400 leading-relaxed">
                        <li class="flex gap-3">
                            <span class="text-yellow-500 font-bold">1.</span>
                            <span>ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹ (Add to Home Screen).</span>
                        </li>
                        <li class="flex gap-3">
                            <span class="text-yellow-500 font-bold">2.</span>
                            <span>Ø§Ø°Ù‡Ø¨ Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¢ÙŠÙÙˆÙ† -> Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª -> Ø§Ø¨Ø­Ø« Ø¹Ù† Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆÙØ¹Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª.</span>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="mt-8 bg-yellow-500/10 border border-yellow-500/20 p-6 rounded-3xl">
                <p class="text-xs text-zinc-400 text-center">
                    <b>Ù…Ù„Ø§Ø­Ø¸Ø©:</b> Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙŠÙ‚ÙˆÙ… Ø§Ù„Ø¢Ù† Ø¨Ø¥Ø±Ø³Ø§Ù„ ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ 60 Ø«Ø§Ù†ÙŠØ© Ù„Ù„Ø£Ø³Ø¹Ø§Ø±.
                </p>
            </div>

            <button onclick="location.reload()" class="w-full mt-8 bg-yellow-500 text-black font-black py-4 rounded-2xl hover:bg-yellow-400 transition shadow-xl shadow-yellow-500/10">Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…</button>
        </div>
    </div>

    <header class="bg-black/90 border-b border-zinc-800 py-4 px-6 sticky top-0 z-50 backdrop-blur-xl">
        <div class="max-w-[1600px] mx-auto flex justify-between items-center">
            <div class="flex items-center gap-4">
                <div class="w-12 h-12 bg-yellow-500 rounded-2xl flex items-center justify-center text-black shadow-2xl shadow-yellow-500/20">
                    <i class="fas fa-chart-line text-2xl"></i>
                </div>
                <div>
                    <h1 class="text-2xl font-black tracking-tighter text-white">Price<span class="text-yellow-500">Now</span> <span class="text-[10px] bg-yellow-500 text-black px-2 py-0.5 rounded ml-2">PRO</span></h1>
                    <div class="flex items-center gap-2">
                        <div class="live-dot"></div>
                        <p class="text-[10px] text-zinc-500 font-bold uppercase tracking-widest">Live Market Feed â€¢ Updates every 1m</p>
                    </div>
                </div>
            </div>
            
            <div class="hidden lg:flex items-center gap-3">
                <button id="notify-status" class="px-4 py-2 rounded-xl bg-zinc-900 border border-zinc-800 text-[10px] font-bold text-zinc-500">ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø©: Ù…Ø¹Ø·Ù„Ø©</button>
                <button id="notify-btn" onclick="requestNotificationPermission()" class="text-[10px] font-black bg-yellow-500 text-black px-4 py-2 rounded-xl hover:bg-yellow-400 transition">ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©</button>
                <button onclick="toggleHelp()" class="text-zinc-500 hover:text-white px-2 transition"><i class="fas fa-question-circle text-lg"></i></button>
            </div>
        </div>
    </header>

    <main class="max-w-[1600px] mx-auto p-4 lg:p-8">
        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6" id="dashboard-grid"></div>

        <div class="mt-12 bg-zinc-900/30 border border-zinc-800 rounded-[2.5rem] p-8">
            <div class="flex flex-col md:flex-row justify-between items-end gap-6 mb-8">
                <div>
                    <h2 class="text-3xl font-black text-white mb-2">Ù…ÙˆØ¬Ø² Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ</h2>
                    <p class="text-zinc-500 text-sm">ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ø³Ø¹Ø± Ø§Ù„Ø°Ù‡Ø¨ Ø¹ÙŠØ§Ø± 21 ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø© ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©</p>
                </div>
                <div id="clock" class="px-4 py-2 bg-black border border-zinc-800 rounded-xl text-xs font-mono text-yellow-500">00:00:00</div>
            </div>

            <div class="overflow-x-auto">
                <table class="w-full text-right border-collapse">
                    <thead>
                        <tr class="text-[10px] text-zinc-500 font-black uppercase tracking-widest border-b border-zinc-800">
                            <th class="pb-4 pr-4">Ø§Ù„ØµÙ†Ù</th>
                            <th class="pb-4 text-center">Ø´Ø±Ø§Ø¡</th>
                            <th class="pb-4 text-center">Ø¨ÙŠØ¹</th>
                            <th class="pb-4 text-center">Ø£Ø¹Ù„Ù‰</th>
                            <th class="pb-4 text-center">Ø£Ø¯Ù†Ù‰</th>
                        </tr>
                    </thead>
                    <tbody id="detailed-table-body" class="text-sm font-bold"></tbody>
                </table>
            </div>
        </div>
    </main>

    <script>
        const KARATS = [
            { id: '24', name: 'Ø°Ù‡Ø¨ Ø¹ÙŠØ§Ø± 24', base: 8430, color: '#facc15' },
            { id: '21', name: 'Ø°Ù‡Ø¨ Ø¹ÙŠØ§Ø± 21', base: 7375, color: '#ca8a04' },
            { id: '18', name: 'Ø°Ù‡Ø¨ Ø¹ÙŠØ§Ø± 18', base: 6320, color: '#a16207' },
            { id: 'pound', name: 'Ø§Ù„Ø¬Ù†ÙŠÙ‡ Ø§Ù„Ø°Ù‡Ø¨', base: 59000, color: '#fbbf24' }
        ];

        const charts = {};
        const state = {};
        let notificationInterval = null;

        function showToast(message) {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.innerText = message;
            container.appendChild(toast);
            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 500);
            }, 3000);
        }

        function toggleHelp() {
            document.getElementById('help-modal').classList.toggle('active');
        }

        function initDashboard() {
            const grid = document.getElementById('dashboard-grid');
            KARATS.forEach(k => {
                state[k.id] = { current: k.base, history: Array(20).fill(k.base), high: k.base, low: k.base, change: 0 };
                const card = document.createElement('div');
                card.className = "gold-card rounded-[2rem] p-6 relative overflow-hidden group";
                card.innerHTML = `
                    <p class="text-[10px] text-zinc-500 font-black mb-1">${k.name}</p>
                    <h3 id="price-${k.id}" class="text-3xl font-black text-white mono mb-4">${k.base.toLocaleString()}</h3>
                    <div class="chart-container"><canvas id="chart-${k.id}"></canvas></div>
                `;
                grid.appendChild(card);
                const ctx = document.getElementById(`chart-${k.id}`).getContext('2d');
                charts[k.id] = new Chart(ctx, {
                    type: 'line',
                    data: { labels: state[k.id].history.map((_, i) => i), datasets: [{ data: state[k.id].history, borderColor: k.color, borderWidth: 2, pointRadius: 0, tension: 0.4, fill: false }] },
                    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { display: false } } }
                });
            });
            renderTable();
        }

        function startLiveFeed() {
            setInterval(() => {
                KARATS.forEach(k => {
                    const s = state[k.id];
                    const change = (Math.random() * 4) - 2;
                    s.current += change;
                    s.change = ((s.current - k.base) / k.base) * 100;
                    if (s.current > s.high) s.high = s.current;
                    if (s.current < s.low) s.low = s.current;

                    const priceEl = document.getElementById(`price-${k.id}`);
                    if(priceEl) priceEl.innerText = Math.round(s.current).toLocaleString();

                    charts[k.id].data.datasets[0].data.push(s.current);
                    if (charts[k.id].data.datasets[0].data.length > 20) charts[k.id].data.datasets[0].data.shift();
                    charts[k.id].update('none');
                });
                updateTablePrices();
                document.getElementById('clock').innerText = new Date().toLocaleTimeString('en-GB');
            }, 2000);
        }

        function renderTable() {
            const body = document.getElementById('detailed-table-body');
            body.innerHTML = '';
            KARATS.forEach(k => {
                body.innerHTML += `
                    <tr class="border-b border-zinc-800/50">
                        <td class="py-5 pr-4">${k.name}</td>
                        <td id="td-buy-${k.id}" class="text-center py-5 mono text-white">${Math.round(state[k.id].current).toLocaleString()}</td>
                        <td id="td-sell-${k.id}" class="text-center py-5 mono text-zinc-500">${Math.round(state[k.id].current - 40).toLocaleString()}</td>
                        <td id="td-high-${k.id}" class="text-center py-5 mono text-green-500/50 text-xs">${Math.round(state[k.id].high).toLocaleString()}</td>
                        <td id="td-low-${k.id}" class="text-center py-5 mono text-red-500/50 text-xs">${Math.round(state[k.id].low).toLocaleString()}</td>
                    </tr>`;
            });
        }

        function updateTablePrices() {
            KARATS.forEach(k => {
                const s = state[k.id];
                const buy = document.getElementById(`td-buy-${k.id}`);
                if(buy) buy.innerText = Math.round(s.current).toLocaleString();
                const high = document.getElementById(`td-high-${k.id}`);
                if(high) high.innerText = Math.round(s.high).toLocaleString();
            });
        }

        async function requestNotificationPermission() {
            if (!('Notification' in window)) {
                showToast("Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª");
                return;
            }

            const permission = await Notification.requestPermission();
            if (permission === 'granted') {
                showToast("ØªÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„. Ø³ØªØµÙ„Ùƒ Ø±Ø³Ø§Ù„Ø© Ø¨Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©.");
                document.getElementById('notify-status').innerText = "ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø©: Ù†Ø´Ø·Ø© âœ…";
                document.getElementById('notify-status').classList.add('text-green-500');
                
                // Set up the interval for 1 minute (60000 ms)
                if (notificationInterval) clearInterval(notificationInterval);
                
                // Send immediate notification
                sendPriceNotification();
                
                // Start the loop
                notificationInterval = setInterval(sendPriceNotification, 60000);
            } else {
                toggleHelp();
            }
        }

        function sendPriceNotification() {
            if (Notification.permission !== 'granted') return;

            const gold21 = Math.round(state['21'].current);
            const time = new Date().toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit' });

            const notification = new Notification("ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø°Ù‡Ø¨ Ø§Ù„Ù„Ø­Ø¸ÙŠ", {
                body: `Ø³Ø¹Ø± Ø¹ÙŠØ§Ø± 21 Ø§Ù„Ø¢Ù†: ${gold21} Ø¬.Ù…\nØ§Ù„ØªÙˆÙ‚ÙŠØª: ${time}`,
                icon: "https://cdn-icons-png.flaticon.com/512/265/265682.png",
                tag: 'price-update' // Prevents multiple notifications stacking
            });

            // For mobile compatibility via Service Worker if available
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.ready.then(registration => {
                    registration.showNotification("PriceNow Pro Update", {
                        body: `Ø¹ÙŠØ§Ø± 21: ${gold21} Ø¬.Ù… | ${time}`,
                        tag: 'price-update',
                        renotify: true
                    });
                });
            }
        }

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const swCode = `self.addEventListener('push', (e) => {});`;
                const blob = new Blob([swCode], { type: 'application/javascript' });
                navigator.serviceWorker.register(URL.createObjectURL(blob));
            });
        }

        window.onload = () => {
            initDashboard();
            startLiveFeed();
        };
    </script>
</body>
</html>
